---
title: "Moving Beyond Linearity"
author: "Carla, Dordor & Hadi"
date: "2/4/2022"
output:
  ioslides_presentation: 
    logo: s.png
    widescreen: yes
    smaller: yes
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(prettydoc)
library(caret)
library(MASS)
library(gam)
library(splines)
library(ISLR)
library(Information)
library(sp)
library(data.table)
library(mgcv)
library(gamair)
library(mgcv)
library(data.table)
data(mcycle)
data(Wage)
data(mpg)
new_credit_data<-fread('credit.csv')
dat<-fread('datafortest.csv')

```

## Fitting linear Model is not good choice!

```{r linear}
renderPlot({
  
  # Fit a linear model
lm_mod <- lm(accel~times, data = mcycle)
# Visualize the model
termplot(lm_mod, partial.resid = TRUE, se = TRUE,col.res = "purple",lwd.term=4,lty.se=2,lwd.se=2)
})
```

```{r include = TRUE}
gam_mod <- gam(accel ~ s(times), data = mcycle, method = "REML")
gam_mod$sp
```

## GAM Flexibility and interpretibility

GAMs....

$$
\sum_{i = 1}^{n}{( y_i - g(x_i))^2} + \lambda\int g^" (t)^2 dt
$$

## Trade off Flexibility VS Overfitting

```{r gam.flexiblity}
inputPanel(
  selectInput("SP", label = "smoothing parameter",
              choices = c(0.1, 0.01, 0.001, 0.0001,0.00001,0.000001), selected = 0.1),
  
  sliderInput("BF", label = "Number of basis functions",
              min = 1, max = 50, value = 1, step = 1)
)

renderPlot({
  gam_mod_s2 <- gam(accel ~ s(times, k = as.numeric(input$BF)), data = mcycle, sp = as.numeric(input$SP))
  
  plot(gam_mod_s2, residuals = TRUE, pch = 1,cex=1,shade = TRUE, shade.col = "hotpink")
})
```

## GAMs for Regression Problem

$$
y_i=\beta_0+\beta_1X_{i1}+\beta_2X_{i2}+...+\beta_pX_{ip}+\epsilon_i
$$ $$
y_i=\beta_0+\sum_{i = 1}^{p}{f_i(X_{ij} )+\epsilon_i} 
$$

$$
= \beta_0+f_1(X_{i1} )+f_2(X_{i2} )+...+f_p(X_{ip} )+\epsilon_i
$$

## GAM for Regression Problem fitting model

$$
FuelConsumption=\beta_0+f_1(weight)+f_2(length)+f_3(price)+\epsilon
$$

```{r gam.regresion}



renderPlot({
      # Fit the model
      mod_city <- gam(city.mpg ~ s(weight)+s(length)+s(price), 
                data = mpg, method = "REML")
      par(mfrow=c(1,3))
      # Plot the model
      plot(mod_city)
})


```

## GAM for Regression Problem summary

```{r include = TRUE}
mod_city <- gam(city.mpg ~ s(weight)+s(length)+s(price), 
                data = mpg, method = "REML")
summary(mod_city)
```

## GAMs for Classification Problem

$$
log(\frac{p(x)}{1-p(x)})=\beta_0+\beta_1X_1+\beta_2X_2+...+\beta_pX_p
$$

$$
log(\frac{p(x)}{1-p(x)})=\beta_0+f_1(X_1)+f_2(X_2)+...+f_p(X_p)
$$

$$
log(\frac{p(x)}{1-p(x)})=\beta_0+\beta_1\times year+f_2(age)+f_3(education)
$$

## GAMs for Classification Problem

$$
p(x)=Pr(FuelConsumption>24|weight,length,price)
$$

```{r gam.clasification}
renderPlot({
      mod_city_log <- gam(I(city.mpg>24) ~ s(weight)+s(length)+s(price), 
                data = mpg,family=binomial, method = "REML")

      par(mfrow=c(1,3))
      
      plot(mod_city_log)
})


```

## GAMs for Classification Problem summary

```{r include = TRUE}
mod_city_log <- gam(I(city.mpg>24) ~ s(weight)+s(length)+s(price), 
                data = mpg,family=binomial, method = "REML")
summary(mod_city_log)
```

## Adding qualitative (categorical) variable

```{r include = TRUE}
# Fit the model
        mod_city2 <- gam(city.mpg ~ s(weight) +drive, 
                     data = mpg, method = "REML")
summary(mod_city2)
```

## Adding qualitative (categorical) variable plot

```{r outside}


renderPlot({
  
        # Fit the model
        mod_city2 <- gam(city.mpg ~ s(weight) +drive, 
                     data = mpg, method = "REML")
    
        # Plot the model
        plot(mod_city2, all.terms = TRUE, pages = 1)

  

})
```

## Adding qualitative variable to smooth function {style="font_size:15"}

```{r include = TRUE}
# Fit the model
        # Fit the model
        mod_city3 <- gam(city.mpg ~ s(weight,by=drive)+drive, 
                         data = mpg, method = "REML")
summary(mod_city3)
```

## Adding qualitative variable to smooth function Plot

```{r inside}


renderPlot({
  

  
        # Fit the model
        mod_city3 <- gam(city.mpg ~ s(weight,by=drive)+drive, 
                         data = mpg, method = "REML")
        par(mfrow=c(1,3))
        # Plot the model
        plot(mod_city3)
  

})
```

## Bullets

-   Bullet 1
-   Bullet 2
-   Bullet 3

## R Output

```{r cars}
summary(cars)
```
